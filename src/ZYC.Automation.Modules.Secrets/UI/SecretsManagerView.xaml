<page:PageBase x:Class="ZYC.Automation.Modules.Secrets.UI.SecretsManagerView"
               x:ClassModifier="internal"
               xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
               xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
               xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
               xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
               xmlns:system="clr-namespace:System;assembly=System.Runtime"
               xmlns:page="clr-namespace:ZYC.Automation.Core.Page;assembly=ZYC.Automation.Core"
               xmlns:bindings="clr-namespace:ZYC.Automation.Core.Bindings;assembly=ZYC.Automation.Core"
               xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
               xmlns:localConverters="clr-namespace:ZYC.Automation.Modules.Secrets.Converters"
               xmlns:converters="clr-namespace:ZYC.Automation.Core.Converters;assembly=ZYC.Automation.Core"
               xmlns:abstractions="clr-namespace:ZYC.Automation.Modules.Settings.Abstractions;assembly=ZYC.Automation.Modules.Settings.Abstractions"
               xmlns:wpf="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
               xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
               mc:Ignorable="d"
               d:DesignHeight="450" d:DesignWidth="800"
               Title="Secrets"
               Loaded="OnSecretsManagerViewLoaded"
               DataContext="{Binding RelativeSource={RelativeSource Self}}">
    <page:PageBase.HeaderAdditionContent>
        <TextBox Text="{Binding FilterText, UpdateSourceTrigger=PropertyChanged}"
                 Width="256"
                 Height="24"
                 HorizontalAlignment="Right"
                 mah:TextBoxHelper.Watermark="Search secrets..."
                 Style="{DynamicResource MahApps.Styles.TextBox.Search}" />
    </page:PageBase.HeaderAdditionContent>
    <Grid>
        <ScrollViewer VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="0 8 0 0">
            <ItemsControl x:Name="ItemsControl"
                          ItemsSource="{Binding  SecretGroupsCollectionView}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel>
                            <!-- ReSharper disable Xaml.BindingWithContextNotResolved -->
                            <wpf:TextBlock VerticalAlignment="Center"
                                           FontWeight="SemiBold">
                                <Run Text="🔑 " />
                                <Run Text="{Binding Name,Mode=OneWay}" />
                            </wpf:TextBlock>
                            <ItemsControl ItemsSource="{Binding SettingItems}"
                                          Margin="16 8">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal"
                                                        Margin="8"
                                                        VerticalAlignment="Center"
                                                        Background="Transparent"
                                                        ToolTip="{bindings:LBinding Description}">
                                                <wpf:TextBlock Text="{Binding Name}"
                                                               Margin="0 0 8 0"
                                                               VerticalAlignment="Center" />
                                            </StackPanel>
                                            <ContentPresenter Content="{Binding Value}"
                                                              Margin="8">
                                                <ContentPresenter.Resources>
                                                    <DataTemplate DataType="{x:Type system:Int32}">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <Grid>
                                                                <TextBox
                                                                    Text="{Binding Path=.,Converter={localConverters:PasswordMaskConverter},Mode=OneWay}"
                                                                    IsEnabled="False"
                                                                    VerticalContentAlignment="Center"
                                                                    Visibility="{Binding Path=Children[1].IsChecked,RelativeSource={RelativeSource AncestorType=Grid,AncestorLevel=2},Converter={converters:BoolToVisibilityConverter Reverse=True}}" />
                                                                <TextBox Text="{Binding .}"
                                                                         VerticalContentAlignment="Center"
                                                                         Tag="{Binding DataContext,RelativeSource={RelativeSource AncestorType=StackPanel}}"
                                                                         LostFocus="OnTextBoxLostFocus"
                                                                         KeyDown="OnTextBoxKeyDown"
                                                                         Visibility="{Binding Path=Children[1].IsChecked,RelativeSource={RelativeSource AncestorType=Grid,AncestorLevel=2},Converter={converters:BoolToVisibilityConverter}}" />
                                                            </Grid>
                                                            <ToggleButton Grid.Column="1"
                                                                          Margin="16 0 0 0"
                                                                          Background="Transparent"
                                                                          VerticalContentAlignment="Top"
                                                                          VerticalAlignment="Top">
                                                                <iconPacks:PackIconMaterial
                                                                    Kind="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton},Path=IsChecked,Converter={localConverters:ToggleButtonIconKindConverter}}"
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"
                                                                    Width="16"
                                                                    Height="16" />
                                                            </ToggleButton>
                                                        </Grid>
                                                    </DataTemplate>
                                                    <DataTemplate DataType="{x:Type system:String}">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <Grid>
                                                                <TextBox
                                                                    Text="{Binding Path=.,Converter={localConverters:PasswordMaskConverter},Mode=OneWay}"
                                                                    IsEnabled="False"
                                                                    VerticalContentAlignment="Center"
                                                                    Visibility="{Binding Path=Children[1].IsChecked,RelativeSource={RelativeSource AncestorType=Grid,AncestorLevel=2},Converter={converters:BoolToVisibilityConverter Reverse=True}}" />
                                                                <TextBox Text="{Binding .}"
                                                                         VerticalContentAlignment="Center"
                                                                         Tag="{Binding DataContext,RelativeSource={RelativeSource AncestorType=StackPanel}}"
                                                                         LostFocus="OnTextBoxLostFocus"
                                                                         KeyDown="OnTextBoxKeyDown"
                                                                         Visibility="{Binding Path=Children[1].IsChecked,RelativeSource={RelativeSource AncestorType=Grid,AncestorLevel=2},Converter={converters:BoolToVisibilityConverter}}" />
                                                            </Grid>
                                                            <ToggleButton Grid.Column="1"
                                                                          Margin="16 0 0 0"
                                                                          Background="Transparent"
                                                                          VerticalContentAlignment="Top"
                                                                          VerticalAlignment="Top">
                                                                <iconPacks:PackIconMaterial
                                                                    Kind="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton},Path=IsChecked,Converter={localConverters:ToggleButtonIconKindConverter}}"
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"
                                                                    Width="16"
                                                                    Height="16" />
                                                            </ToggleButton>
                                                        </Grid>
                                                    </DataTemplate>
                                                    <DataTemplate DataType="{x:Type abstractions:MultilineText}">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <Grid>
                                                                <TextBox Height="128"
                                                                         MinHeight="128"
                                                                         VerticalScrollBarVisibility="Visible"
                                                                         HorizontalScrollBarVisibility="Disabled"
                                                                         TextWrapping="Wrap"
                                                                         AutoWordSelection="True"
                                                                         Text="{Binding Text,Converter={localConverters:PasswordMaskConverter},Mode=OneWay}"
                                                                         IsEnabled="False"
                                                                         Visibility="{Binding Path=Children[1].IsChecked,RelativeSource={RelativeSource AncestorType=Grid,AncestorLevel=2},Converter={converters:BoolToVisibilityConverter Reverse=True}}" />
                                                                <TextBox Height="128"
                                                                         MinHeight="128"
                                                                         VerticalScrollBarVisibility="Visible"
                                                                         HorizontalScrollBarVisibility="Disabled"
                                                                         TextWrapping="Wrap"
                                                                         AutoWordSelection="True"
                                                                         Text="{Binding Text,Mode=OneWay}"
                                                                         Tag="{Binding DataContext,RelativeSource={RelativeSource AncestorType=StackPanel}}"
                                                                         LostFocus="OnTextBoxLostFocus"
                                                                         KeyDown="OnTextBoxKeyDown"
                                                                         Visibility="{Binding Path=Children[1].IsChecked,RelativeSource={RelativeSource AncestorType=Grid,AncestorLevel=2},Converter={converters:BoolToVisibilityConverter}}" />
                                                            </Grid>
                                                            <ToggleButton Grid.Column="1"
                                                                          Margin="16 0 0 0"
                                                                          Background="Transparent"
                                                                          VerticalContentAlignment="Top"
                                                                          VerticalAlignment="Top">
                                                                <iconPacks:PackIconMaterial
                                                                    Kind="{Binding RelativeSource={RelativeSource AncestorType=ToggleButton},Path=IsChecked,Converter={localConverters:ToggleButtonIconKindConverter}}"
                                                                    HorizontalAlignment="Center"
                                                                    VerticalAlignment="Center"
                                                                    Width="16"
                                                                    Height="16" />
                                                            </ToggleButton>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ContentPresenter.Resources>
                                            </ContentPresenter>
                                        </StackPanel>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
        <!--!WARNING Binding ElementName directly to ItemControl's Items.Count seems reasonable here. However, on the first launch, when loading in the background, the binding will fail due to the visual tree loading order.-->
        <page:NoItemView
            Visibility="{Binding CollectionViewCount,Converter={converters:IntToVisibilityConverter Reverse=True},FallbackValue=Collapsed}" />
    </Grid>
</page:PageBase>