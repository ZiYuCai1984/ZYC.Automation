<page:PageBase x:Class="ZYC.Automation.Modules.ModuleManager.UI.NuGetModuleManagerView"
               x:ClassModifier="internal"
               xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
               xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
               xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
               xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
               xmlns:page="clr-namespace:ZYC.Automation.Core.Page;assembly=ZYC.Automation.Core"
               xmlns:localizations="clr-namespace:ZYC.Automation.Core.Localizations;assembly=ZYC.Automation.Core"
               xmlns:converters="clr-namespace:ZYC.Automation.Core.Converters;assembly=ZYC.Automation.Core"
               xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
               xmlns:markupEx="clr-namespace:ZYC.Automation.Core.MarkupEx;assembly=ZYC.Automation.Core"
               xmlns:commands="clr-namespace:ZYC.Automation.Modules.ModuleManager.Commands"
               xmlns:buttons="clr-namespace:ZYC.Automation.Core.Buttons;assembly=ZYC.Automation.Core"
               xmlns:nugetCommands="clr-namespace:ZYC.Automation.Modules.NuGet.Abstractions.Commands;assembly=ZYC.Automation.Modules.NuGet.Abstractions"
               xmlns:core="clr-namespace:ZYC.Automation.Core;assembly=ZYC.Automation.Core"
               mc:Ignorable="d"
               d:DesignHeight="450" d:DesignWidth="800"
               Title="{localizations:L NuGet Modules}"
               DataContext="{Binding RelativeSource={RelativeSource Self}}">
    <page:PageBase.HeaderAdditionContent>
        <StackPanel HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    Orientation="Horizontal">
            <buttons:IconButton Text="{localizations:L Clear nuget http cache}"
                                Kind="DeleteOutline"
                                Margin="0 0 8 0"
                                Command="{markupEx:LifetimeScopeResolve nugetCommands:IClearNuGetHttpCacheCommand}"/>
            <buttons:IconButton Text="Refresh"
                                Kind="Refresh"
                                Command="{markupEx:LifetimeScopeResolve commands:RefreshNuGetModuleCommand}"
                                CommandParameter="{Binding .}" />
        </StackPanel>
    </page:PageBase.HeaderAdditionContent>
    <Grid>
        <ScrollViewer HorizontalScrollBarVisibility="Disabled"
                  VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding NuGetModules}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderThickness="0 0 0 1"
                            BorderBrush="{DynamicResource MahApps.Brushes.Validation2}"
                            Margin="0 0 16 0">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <Grid Margin="0 8 0 16">
                                    <Grid.RowDefinitions>
                                        <RowDefinition />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <Grid Margin="0 4 4 4"
                                      Background="Transparent">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="64" />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <core:HybridIcon
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Width="24"
                                            Height="24" 
                                            FontSize="16"
                                            Icon="{Binding Icon}"/>
                                        <TextBlock Grid.Column="1"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Left"
                                               Margin="8 0 0 0"
                                               TextTrimming="WordEllipsis"
                                               FontWeight="Bold"
                                               Text="{Binding ModuleAssemblyName}" />
                                    </Grid>

                                    <Grid Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="64" />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <Grid>
                                            <TextBlock HorizontalAlignment="Center"
                                                   FontWeight="Bold"
                                                   Foreground="Green"
                                                   Text="*Installed*"
                                                   Visibility="{Binding Installed,Converter={converters:BoolToVisibilityConverter}}" />
                                        </Grid>
                                        <StackPanel Grid.Column="1"
                                                Margin="8 0 0 0">

                                            <TextBlock Margin="0 0 0 4">
                                            <Run Text="Dependence on" />
                                            <Run Text=" : " />
                                            <Run Text="{Binding DependencyOn.Length,Mode=OneWay}" />
                                            </TextBlock>

                                            <TextBlock Text="No Item"
                                                   Margin="32 0 0 4"
                                                   Visibility="{Binding DependencyOn.Length,Converter={converters:IntToVisibilityConverter Reverse=True},FallbackValue=Collapsed}" />

                                            <ItemsControl ItemsSource="{Binding DependencyOn}"
                                                      Margin="32 0 0 0">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding ModuleAssemblyName}"
                                                               Margin="0 0 0 4" />
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>

                                            <TextBlock Margin="0 0 0 4">
                                            <Run Text="Dependence by" />
                                            <Run Text=" : " />
                                            <Run Text="{Binding DependencyBy.Length,Mode=OneWay}" />
                                            </TextBlock>

                                            <TextBlock Text="No Item"
                                                   Margin="32 0 0 4"
                                                   Visibility="{Binding DependencyBy.Length,Converter={converters:IntToVisibilityConverter Reverse=True},FallbackValue=Collapsed}" />

                                            <ItemsControl ItemsSource="{Binding DependencyBy}"
                                                      Margin="32 0 0 0">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding ModuleAssemblyName}"
                                                               Margin="0 0 0 4" />
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>

                                        </StackPanel>

                                    </Grid>

                                </Grid>

                                <StackPanel Grid.Column="1"
                                        Orientation="Horizontal"
                                        Margin="16 16 0 8"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top">
                                    <!--TODO Supports injecting custom operations-->
                                    <Button Margin="8 0  0 8"
                                        Command="{markupEx:LifetimeScopeResolve commands:InstallNuGetModuleCommand}"
                                        CommandParameter="{Binding .}">
                                        <iconPacks:PackIconMaterial Kind="DownloadOutline"
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Width="16"
                                                                Height="16" />
                                    </Button>
                                    <Button Margin="8 0  0 8"
                                        Command="{markupEx:LifetimeScopeResolve commands:UninstallNuGetModuleCommand}"
                                        CommandParameter="{Binding .}">
                                        <iconPacks:PackIconMaterial Kind="DeleteOutline"
                                                                HorizontalAlignment="Center"
                                                                VerticalAlignment="Center"
                                                                Width="16"
                                                                Height="16" />
                                    </Button>
                                </StackPanel>

                            </Grid>


                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <page:NoItemView Visibility="{Binding ModulesCount,Converter={converters:IntToVisibilityConverter Reverse=True}}"/>
    </Grid>
</page:PageBase>